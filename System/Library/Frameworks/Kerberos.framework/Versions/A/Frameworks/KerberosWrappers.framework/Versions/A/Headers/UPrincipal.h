/* * KClientPrincipal * * Abstraction for a KClient principal * * $Header: /cvs/macdev/mit/lib/WrappersLib/Headers/KerberosWrappers/UPrincipal.h,v 1.15 2001/02/26 19:30:15 meeroh Exp $ */ #ifndef UPrincipal_h_#define UPrincipal_h_#include <string>#include <stdexcept>#include <Kerberos5/Kerberos5.h>#include <CredentialsCache/CredentialsCache.h>#include <KerberosLogin/KerberosLogin.h>#include <KerberosWrappers/UAutoPtr.h>#include <KerberosWrappers/UKerberos5Context.h>#if TARGET_RT_MAC_MACHO    #define Export_#else    #ifdef CompilingKrbWrappers        #define Export_ __declspec (export)    #else        #define Export_ __declspec (import)    #endif#endif /* MACHO */class UKerberos5Context;class UPrincipalAutoPtrDeleter {	public: Export_ static void Delete (krb5_principal	inPrincipal);};typedef	UAutoPtr <krb5_principal_data, UPrincipalAutoPtrDeleter>		UPrincipalAutoPtr;typedef	UPrincipalAutoPtr::UAutoPtrRef									UPrincipalAutoPtrRef;class UPrincipal;Export_ Boolean operator == (const UPrincipal& inLeft, const UPrincipal& inRight);class UPrincipal:	public UPrincipalAutoPtr {public:		enum EVersion {			kerberosV4 = cc_credentials_v4,			kerberosV5 = cc_credentials_v5,			kerberosV4And5 = cc_credentials_v4_v5		};			UPrincipal (			krb5_principal				inString = 0):			UPrincipalAutoPtr (inString) {}		UPrincipal (			UPrincipalAutoPtrRef		inReference):			UPrincipalAutoPtr (inReference) {}		Export_ UPrincipal (			EVersion						inVersion,			const char*						inPrincipal);		Export_ UPrincipal (			EVersion						inVersion,			const char*						inName,			const char*						inInstance,			const char*						inRealm);		~UPrincipal () {}			UPrincipal&			operator = (			UPrincipalAutoPtr::UAutoPtrRef	inOriginal) {			Reset (inOriginal.mPtr);			return *this;		}				UPrincipal&			operator = (			UPrincipal&	inOriginal) {			Reset (inOriginal.Release ());			return *this;		}				UPrincipal&			operator = (			krb5_principal	inOriginal) {			Reset (inOriginal);			return *this;		}				Export_ std::string GetString (			EVersion						inVersion) const;													Export_ std::string GetDisplayString (			EVersion						inVersion) const;													Export_ void GetTriplet (			EVersion						inVersion,			std::string&					outName,			std::string&					outInstance,			std::string&					outRealm) const;													Export_ bool		IsTicketGrantingService (			EVersion						inVersion) const;				Export_ std::string GetName (			EVersion						inVersion) const;		Export_ std::string GetInstance (			EVersion						inVersion,			UInt32							inIndex = 1) const;		Export_ std::string GetRealm (			EVersion						inVersion) const;					Export_ UPrincipal	Clone () const;					Export_ KLPrincipal GetKLPrincipal () const;													friend Boolean operator == (const UPrincipal& inLeft, const UPrincipal& inRight);	private:		static ULazyKerberos5Context		sContext;		friend pascal void TerminateWrappersLib ();		friend class UPrincipalAutoPtrDeleter;		};/* * Exception classes */ class UPrincipalLogicError:	public std::logic_error {public:	explicit UPrincipalLogicError (		OSStatus		inError):		std::logic_error ("UPrincipalLogicError"),		mError (inError) {}		long Error () const { return mError; }private:	long			mError;};class UPrincipalRuntimeError:	public std::runtime_error {public:	explicit UPrincipalRuntimeError (		OSStatus		inError):		std::runtime_error ("UPrincipalRuntimeError"),		mError (inError) {}		long Error () const { return mError; }private:	long			mError;};#ifdef CompilingKrbWrappers	#undef Export_#endif#endif /* UPrincipal_h_ */